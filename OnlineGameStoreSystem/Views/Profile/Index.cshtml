@model OnlineGameStoreSystem.Models.ViewModels.ProfileViewModel;
@{
    ViewData["Title"] = "Profile";

    // 1. 从 Claims 读取当前登录用户 ID
    var userId = User.FindFirst("UserId")?.Value;

    // 2. 根据 userId 从数据库取得用户资料
    User? currentUser = null;
    if (!string.IsNullOrEmpty(userId))
    {
        currentUser = db.Users.FirstOrDefault(u => u.Id.ToString() == userId);
    }
}

<link rel="stylesheet" href="~/css/pages/Profile.css" asp-append-version="true" />

<h1 class="User-Profile">User Profile</h1>
<div class="profile-header">
    <div class="profile-left">
        <img class="profile-avatar"
             src="@(!string.IsNullOrEmpty(currentUser?.AvatarUrl) ? currentUser.AvatarUrl : Url.Content("~/images/avatar_default.png"))" />
    </div>


    <div class="profile-right">
        <h2>
            Gamer Tag: <span class="username">@Model.Username</span>
        </h2>

        @if (Model.IsDeveloper)
        {
            <span class="badge badge-info">Developer</span>
        }

        <p>
            User Description:
            <span class="user-summary">
                @(string.IsNullOrEmpty(Model.Summary) ? "Empty" : Model.Summary)
            </span>
        </p>

        <p>Joined on @Model.CreatedAt.ToString("yyyy-MM-dd")</p>
    </div>
</div>



<h1 class="Tags">Favorite Tags</h1>
<div class="tags-header">
    @if (Model.FavoriteTags == null || !Model.FavoriteTags.Any())
    {
        <div class="no-tags-container">
            <p>No favorite tags selected.</p>
        </div>
    }
    else
    {
        <div class="tag-list">
            @foreach (var tag in Model.FavoriteTags)
            {
                <span class="tag">@(@tag.Name)</span>
            }
        </div>
    }
</div>

<h1 class="Tags">Recently Comment</h1>
<div class="comment-header">

    @if (Model.UserComments == null || !Model.UserComments.Any())
    {
        <div class="no-tags-container">
            <p>No comments yet.</p>
        </div>
    }
    else
    {
        <div class="comments-grid">
            @foreach (var comment in Model.UserComments)
            {
                <div class="comment-card">
                    <img src="@comment.CoverUrl" alt="@comment.GameTitle" />
                    <div class="comment-info">
                        <p class="game-title">@comment.GameTitle</p>
                        <p class="comment-content">@comment.Content</p>
                        <small class="comment-date">@comment.CreatedAt.ToString("yyyy-MM-dd HH:mm")</small>
                    </div>
                </div>
            }
        </div>
    }
</div>

<h1 class="Tags">Game Library</h1>

@if (Model.PurchasedGames == null || !Model.PurchasedGames.Any())
{
    <div class="games-header">
        <div class="no-tags-container">
            <p>No game yet.</p>
        </div>
    </div>
}
else
{
    <div class="category-slider">
        <button class="cat-btn left-btn" id="leftBtn">&#10094;</button>
        <button class="cat-btn right-btn" id="rightBtn">&#10095;</button>

        <div class="game-list-wrapper">
            <div class="game-list" id="gameList">
                @foreach (var game in Model.PurchasedGames)
                {
                    <a asp-controller="Home" asp-action="GameDetail" asp-route-name="@game.Title.Replace(" ", "_")">
                        <div class="game-card">
                            <img src="@game.CoverUrl" alt="@game.Title" />
                            <div class="game-info">
                                <p class="game-title">@game.Title</p>
                                <p class="game-price">Purchased: @game.PurchasedAt.ToString("yyyy-MM-dd")</p>
                                <p class="game-price">RM @game.PriceAtPurchase</p>
                            </div>
                        </div>
                    </a>
                }
            </div>
        </div>
    </div>
    <div class="dots"></div>
    }

@section Scripts {
    <script src="~/js/components/profile.js" asp-append-version="true"></script>
}